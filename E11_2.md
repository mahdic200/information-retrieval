# E11_2

## روش های ارزیابی موتور های جست و جو با نتایج رتبه بندی شده

اصولا باید این رتبه بندی برای موتور های جست و جو در نظر گرفته بشه . دو موتور جست و جو رو در نظر بگیرید که ۲۰ سند رو به عنوان نتیجه بر میگردونند . که توی موتور جست و جوی نخست ۱۰ مورد اول مرتبط و ۱۰ مورد دوم نامرتبط هست . توی دومی برعکسه ، ۱۰ تای اول نامرتبط و ۱۰ تای دومی مرتبط هستند .

کدوم بهتره ؟ موتور جست و جوی اول . چون سند هایی که توی رتبه های بالاتر قرارداد مرتبط بودند ، بنابراین ما باید به گونه ایی بیایم اندازه گیری کنیم کارایی موتور های جست و جو رو براساس اینکه چقدر اون تاپ رنک هارو به صورت مرتبط برمیگردونه . یعنی اون top k ها واقعا مرتبط باشند .

یک منحنی رو استخراج میکنند به نام precision-recall curve . چجوری این منحنی استخراج میشه ؟ زوج نقطه های گوناگونی از precision recall رو بدست میارن و بعد اینهارو به همدیگه وصل میکنن و با وصل کردن زوج نقاط precision recall به همدیگه میان این منحنی رو رسم میکنند به صورت پیوسته . حالا این زوج های precision recall روی این منحنی چجوری بدست میاد ؟

فرض کنید شما ی کوئری دادید ، برای این کوئری  شما فرضا توی ریکال لول های مختلف پرسیژن لول های مختلفی میتونید بدست بیارید . ده تا سند اول رو در نظر بگیرید ، شما یک ریکال ریت دارد برای اون ، یک پرسیژن دارید . پس این میشه یک precision recall حالا از ده تا میکنید ۲۰ تا . k رو میکنید ۲۰ تا . حالا برای اون ۲۰ تا نتیجه ی اول precision recall رو استخراج میکنید . حالا برای ۳۰ تا ، بعد برای ۴۰ تا بعد برای ۵۰ تا . این درواقع k رو افزایش میدید و این precision recall رو اینجوری میتونید رسم بکنید .

وقتی که ما تعداد سند ها رو افزایش میدیم ، recall داره به سمت ۱ میل میکنه ، اما دقت چه اتفاقی براش میفته ؟ دقت پایین میاد .

## چرا منحنی precision recall دندانه اییه ؟

دلیلش اینه که فرض کنیم روی یک نقطه ایی هستیم از نمودار ، و فرض کنیم k در اون نقطه ۵۰ هست . حالا اگر ۵۰ بشه ۵۱ ، اگر اون یک سندی که اضافه شده اگر مرتبط باشه ، هم ریکال افزایش پیدا میکنه هم دقت افزایش پیدا میکنه . حالا فرض کنید توی یک نقطه ی دیگری هستیم ، حال اگر پنجاه و دومیه نامرتبط باشه چه اتفاقی میفته ؟ ریکال تغییری نمیکنه دقت میاد پایین . بنابراین دندانه دندانه شدن این منحنی بخاط این قضیه است . حالا اگر بخوان این رو تا حدودی برطرف بکنن میان درون یابی (interpolation) انجام میدن برای دقت .

این درون یابی رو چجوری انجام میدن ؟ میگن خب precision رو من برای هر نقطه ایی بخوام درنظر بگیرم ، من میام ماکسیمم precision های بعدی رو میتونم منتسب کنم بهش .

این منحنی ها به ازای یک کوئری استخراج میشن ، چجوری میتونیم این هارو تجمیع کنیم ؟ برآیندشون رو بگیریم ؟

پاسخش اینه که میتونیم از این روش ۱۱ نقطه ایی استفاده بکنیم . ۱۱ نقطه ایی که precision میانگین روشون محاسبه میشه . این روش یک روشیه که بیست ساله پیش استفاده میشده ، توی رقابت هایی که TREC برگزار میکرد از این معیار میومدن استفاده میکردن .

چجوری ؟ میومدن ریکال بین صفر تا یک رو میزاشتن صفر ، یک دهم ، دو دهم ، سه دهم ، چهاردهم ، پنج دهم و همینجوری . این سطح هایی که یک دهم از هم فاصله دارند میشه ۱۱ نقطه . صفر تا یک میشه ۱۱ نقطه . برای این ۱۱ نقطه میومدن precision محاسبه میکردن . هر کوئری مگه یک منحنی precision recall نداره ؟ من precision ریکال صفر ، ریکال یک دهم تا یک رو برای کوئری اول به صورت اینترپوله میام محاسبه میکنم مثلا میشه یک عددی ، برای دومین کوئری هم دوباره همین رو محاسبه میکنم ، دوباره اون هم به ازای هرکدوم از این یازده تا ریکال یک precision داره . بعد precision ریکال صفر رو میام یک میانگین میگیرم اون میشه یک عدد .

دقت یا precision مربوط به ریکال یک دهم رو برای تمام کوئری ها ، هرکدوم یک دقتی بدست آورده بودن دیگه ، اونم دوباره میشه یک دقت ، و یک منحنی بدست میاد برای تمامی کوئری ها .

اینجوری ما میتونیم منحنی precision recall که برای کوئری های مختلف بدست میاد رو یکپارچه کنیم و به صورت یک نمودار نشون بدیم .

## رویکرد Mean Average Precision یا MAP

امروزه هم از این استفاده میشه . میاد از سند شماره ی ۱ شروع میکنه ، انگار یک اشاره گر در نظر میگیره ، دونه دونه نامرتبط هارو رد میکنه ، میره روی مرتبط وای می ایسته .

برای نمونه الان روی سند شماره ی یک هستیم ، روش وای می ایستیم و برای یک کوئری یک precision بدست میاریم . میره سند شماره ی ۲ رو بررسی میکنه ، برای نمونه نامرتبط هست ، میپریم روی سند بعدی ، میریم سراغ سند ۳ ، اگه این مرتبط بود اینجا می ایستیم . دوباره precision بدست میاریم ، به این صورت برای سند ها این کاررو انجام میدیم ، تا یک حدی . برای نمونه ۱۰۰ سند نخست .

پس تعدادی precision بدست میاد ، حال اون precision هارو میانگین میگیریم . اون میشه Average Precision و این میشه Average Precision برای سند شماره ی ۱ . همین کاررو برای سند شماره ی ۳ بدست میاریم . همینجوری میریم جلو و برای تمامی اون سند ها این رو بدست میاریم . در آخر یک میانگین از این ها میگیریم .

اینجوری میاد این معیار عددی رو بدست میاره ، دیگه منحنی وجود نداره ، یک عدد بدست میاره ، و موتور های جست و جو با همین عدد میتونن باهم مقایسه بشن ، هرکدوم که MAP بالاتری داره بهتره .
